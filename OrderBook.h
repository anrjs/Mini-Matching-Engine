#pragma once

#include "Types.h"
#include "Order.h"
#include <list>
#include <unordered_map>

// ============================================================================
// OrderBook 클래스
// ============================================================================
// 주문장(Order Book)을 관리하는 클래스
// 매수 주문(bids)과 매도 주문(asks)을 분리하여 관리하고,
// 주문 추가 및 체결 로직을 처리합니다.
// ============================================================================

class OrderBook {
public:
    // ------------------------------------------------------------------------
    // 주문 관리 메서드
    // ------------------------------------------------------------------------
    
    // 주문을 주문장에 추가
    // @param order 추가할 주문 객체
    void addOrder(const Order& order);
    
    // 주문 체결 로직 수행
    // 현재는 껍데기만 구현되어 있으며, 향후 체결 알고리즘을 구현할 예정
    void matchOrder();

    // 현재 호가창 상태 출력 (디버깅용)
    void printStatus();

    // 주문 취소 (ID 기준으로 매수/매도 검색 후 삭제)
    void cancelOrder(OrderId orderId);

private:
    // ------------------------------------------------------------------------
    // 멤버 변수
    // ------------------------------------------------------------------------
    
    // 매수/매도 주문 대기열 (연결 리스트)
    std::list<Order> bids_;  // 매수 주문 목록
    std::list<Order> asks_;  // 매도 주문 목록

    // 주문 ID -> (Side, 리스트 iterator) 매핑 (O(1) 조회/삭제용)
    using OrderIter = std::list<Order>::iterator;
    std::unordered_map<OrderId, std::pair<Side, OrderIter>> orderMap_;
};
